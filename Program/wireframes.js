let GrpHeaderWireframB = "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";
let GrpHeaderGrpwireB = "gwAgACAABwAUIB4EAAADARcejQYAAAADIBx+CAAAAwAcINUKAAABBR0Jog0AAAEAHyCmDgAAAQUdCXYRAAADABwgfRIAAAAEIBlKFQAAAAAfH+YXAAAEABgg8hoAAAAAIB+pHQAAAAEgHuggAAACABwgMiQAAAEFHQl0JwAABgISHnsoAAADABcgUyoAAAMAHCDVCgAAAQUdCWAsAAAAAyAcfggAAAcAFCBnLQAAAAQgGdgvAAAAAB8f5hcAAAEAHyCmDgAAAQUdCXYyAAABAB0ffTMAAAEFHQlgLAAAAQUdCWAsAAAAASAe6CAAAAABIB7oIAAAAQAdH30zAAABBR0JajYAAAQAGCB0NwAABwAUIC86AAAGABcgnjwAAAIAHSBcPwAAAAIgHExBAAAEABggt0MAAAMAHCChRQAAAAMgG71HAAADARse4UkAAAABIB7PSwAAAwAcIEtOAAAAAiAcQlEAAAACIBxLUwAAAAAgIFRVAAAAASAf7VcAAAECHhyzWQAAAAMgG71HAAAAACAgVFUAAAEAHCCTWwAAAgEbHxVeAAAAASAf7VcAAAMAHCChRQAABAAYIC1gAAAAAiAcF2IAAAACIBxLUwAAAwAcIEtOAAAAAiAdH2QAAAACIBzeZgAAAQIdG1dpAAAAAB4gnmsAAAABHh5UbgAAAgEeH8VwAAABAB8glnMAAAEAHyCcdgAABAEYH/F5AAAAACAghnwAAAAAICDcfwAAAAQgGy6DAAAAACAf2IUAAAAAHyCViAAAAAAgIH2LAAAABCAZto4AAAAAHiCeawAAAAAeIJ5rAAAAACAg3H8AAAEAHyCcdgAABAEYH/F5AAAAACAghnwAAAAAIB/CkAAAAAIfHYGTAAAAACAgfYsAAAACHx2BkwAAAQEcHR2WAAABBR0JfZgAAAAAHyCViAAAAQUdCWo2AAAAACAf2IUAAAADIBuEmQAAAAQfGCCcAAAAAyAalp0AAAADIBqWnQAAAQAbH32fAAAAACAfYqEAAAAFIBUMowAAAQUZGsCkAAACCBoOkqYAAAAAHiCeawAAAwEXHo0GAAADARcejQYAAAADIBqWnQAAAAEgHuggAAAAAyAalp0AAAMBFx6NBgAAAQUdCamnAAAAAiAds6gAAAEFHQmvqwAAAQUdCa+rAAABBR0Jr6sAAAEFHQmvqwAAAAEgH7asAAABBR0J968AAAABIB/9sAAAAAAgIGC0AAABBR0JpbcAAAAFIBiruAAAAQUdCTq7AAABBR0JOrsAAAEFHQk6uwAAAQUdCTq7AAABBR0JOrsAAAAFIBdDvAAAAQUdCWo2AAABBR0JajYAAAEFHQlqNgAAAQUdCWo2AAABBR0JajYAAAEFHQlqNgAAAQUdCWo2AAABBR0JajYAAA==";
let GrpHeaderTranwireB = "agBAAEAABwAUIFYDAAADARcexQUAAAAFIDW2BwAAAgIePCEMAAABBR0JhREAAAEAP0CREgAAAQUdCSgbAAADARwgKhwAAAEFHQn3HgAAAQUdCfceAAAEABgg/h8AAAEFHQn3HgAAAQUdCfceAAABAhocuSIAAAEFHQlvJQAABgISHnsmAAADABcgUygAAAICHjxgKgAAAQUdCcQvAAAABSA1tgcAAAcAFCDSMAAAAgIePGAqAAABBR0JxC8AAAEAP0BBMwAAAQUdCSgbAAABBR0JKBsAAAEFHQkoGwAAAQUdCSgbAAABBR0JKBsAAAEFHQkoGwAAAAA8QNY7AAABBR0JYUUAAAQAGCD+HwAABwAUINIwAAAGARcgZ0YAAAUFFRYnSQAAAQUdCVlKAAAGABcfWksAAAAGHzUcTQAAAAZANKFQAAADARseuVUAAAACIB6nVwAAAQUdCSNaAAABBR0JI1oAAAEFHQkjWgAAAQUdCSNaAAABBh8yLVsAAAEFHQmuXQAAAAZANKFQAAAHCzInsl4AAAEAHCDAYgAAAgEbH0JlAAABBh8yLVsAAAAGHzUcTQAABgAXH1pLAAABBR0J9x4AAAEFHQn3HgAAAQUdCfceAAAAA0A7WmcAAAEFHQn3HgAAAQUdCfceAAAAAB9AMm8AAAABPD25dAAAAwA8QDl8AAABAB8gJIUAAAEAH0AqiAAABwExPreOAAAAACBAaJYAAAEDPD3VnAAAAQUdCSNaAAABBR0JI1oAAAEFHQkjWgAAAQUdCSNaAAABBR0JI1oAAAAAH0AybwAAAAAfQDJvAAABAzw91ZwAAAEAH0DypQAABwExPreOAAAAACBAaJYAAAAAICB9rAAAAwY6OLOvAAABBR0JzrYAAAMGOjizrwAAAQUdCdi3AAABBR0J2LcAAAEFHQnYtwAAAQUdCdi3AAADARcexQUAAAADIBvZuAAAAAQfGHW7AAAABkA067wAAAAGQDTrvAAAAQAbH5jCAAABBR0J2LcAAAAFIBV9xAAAAQUZGjHGAAABBR0J2LcAAAEFHQnYtwAAAwEXHsUFAAADARcexQUAAAAGQDTrvAAAAQUdCfceAAAABkA067wAAAMBFx7FBQAAAQUdCdi3AAA=";

var GrpDataWirefram = [];
var GrpDataGrpwire = [];
var GrpDataTranwire = [];

function parseGrpData(str) {
	let array = atob(str).split("").map(c => c.charCodeAt(0));
	let header = array.splice(0, 6);
	var grpData = [];
	if(array.length % 8 != 0) {
		console.log("Error parsing GRP data.");
		return null;
	}
	while(array.length) {
		let c = array.splice(0, 8);
		grpData.push({
			x: c[0],
			y: c[1],
			w: c[2],
			h: c[3],
			ptr: c[4] + (c[5] << 8) + (c[6] << 16) + (c[7] << 24)
		});
	}
	return grpData;
}

function grpToValues(g) {
	return [g.x + (g.y << 8), g.w + (g.h << 8) + ((g.ptr & 0xFFFF) << 16), g.ptr >>> 16];
}

function wireframesParseCPT()
{
	$("trigger_output").value += wireframesCPT(parseInt($("input_wireframes_player").value), $("inputarea_wireframes_cond").value, $("select_wireframes_type").selectedIndex);
}

function wireframesParse()
{
	let result = wireframesEdit(parseInt($("input_wireframes_uid").value), parseInt($("input_wireframes_target").value), $("select_wireframes_type").selectedIndex);
	$("trigger_output").value += result;
}

function wireframesInit()
{
	if($("inputarea_wireframes_cond").value == "")
	{
		$("inputarea_wireframes_cond").value = "\tSwitch(\"Switch164\", Set);\n// Note: This doesn't work because SC:R EUD simulator is bugged in this part.";
	}
	$("parse_wireframes_cpt").onclick = wireframesParseCPT;
	$("parse_wireframes").onclick = wireframesParse;
	GrpDataWirefram = parseGrpData(GrpHeaderWireframB);
	GrpDataGrpwire = parseGrpData(GrpHeaderGrpwireB);
	GrpDataTranwire = parseGrpData(GrpHeaderTranwireB);
}

function wireframesCPT(player, cond, type)
{
	var out = "";
	var separ = "\n\n//-----------------------------------------------------------------//\n\n";
	var addr = (type == 0 ? "0x0068c204" : (type == 1 ? "0x0068c1f4" : "0x0068c1fc")); //"0x006d1238";
	var trgHead = `Trigger("Player ${player}"){
Conditions:
${cond}

Actions:
	MemoryAddr(0x006509b0, Set To, 4293515047);
}
`; // 4293515047 == -(0x58a364)/4 DeathTableStart

	var trgMidS = `Trigger("Player ${player}"){
Conditions:
${cond}
	Masked MemoryAddr(${addr}, At least, VAL1, VAL1);

Actions:
	MemoryAddr(0x006509b0, Add, VAL2);
}`;
	var trgMid = Array(30).fill("").map((t,i) => trgMidS.replace(/VAL1/g, 2**(31-i)).replace(/VAL2/g, 2**(29-i))).join(separ);

	var trgTail = `Trigger("Player ${player}"){
Conditions:
${cond}

Actions:
	//--- PUT YOUR WIREFRAME EDIT TRIGGERS HERE ---//
	MemoryAddr(0x006509b0, Set To, ${player-1});
}`;

	return trgHead + separ + trgMid + separ + trgTail + separ;
}

function wireframesEdit(uidFrom, uidTo, type, mode) {
	// CPT0 high bits, CPT1 all, CPT2 low bits
	let cpt0 = uidFrom * 2 + 1;
	let dataSet = (type == 0 ? GrpDataWirefram : (type == 1 ? GrpDataGrpwire : GrpDataTranwire));
	mode = mode || 0;

	let dataFrom = grpToValues(dataSet[uidFrom]);
	let dataTo = grpToValues(dataSet[uidTo]);

	let data0LowBits = (uidFrom == 0) ? [0x40, 0x20, 0x40][type] : grpToValues(dataSet[uidFrom-1])[2];
	let data0 = (dataTo[0] << 16) + (data0LowBits & 0xFFFF);
	let data1 = dataTo[1];
	let data2HighBits = grpToValues(dataSet[uidFrom+1])[0];
	let data2 = (data2HighBits << 16) + (dataTo[2] & 0xFFFF);

	let diff0 = (((dataTo[0] - dataFrom[0]) << 16) + 4294967296) % 4294967296;
	let diff1 = ((dataTo[1] - dataFrom[1]) + 4294967296) % 4294967296;
	let diff2 = ((dataTo[2] - dataFrom[2]) + 4294967296) % 4294967296;

	let out = "";
	if(mode == 0) {
		out += `\tMemoryAddr(0x006509b0, Add, ${cpt0});\n`;
		out += `\tSet Deaths("Current Player", "Terran Marine", Add, ${diff0});\n`;
		out += `\tMemoryAddr(0x006509b0, Add, 1);\n`;
		out += `\tSet Deaths("Current Player", "Terran Marine", Add, ${diff1});\n`;

		if(diff2 != 0) {
			out += `\tMemoryAddr(0x006509b0, Add, 1);\n`;
			out += `\tSet Deaths("Current Player", "Terran Marine", Add, ${diff2});\n`;
			out += `\tMemoryAddr(0x006509b0, Subtract, ${cpt0 + 2});\n`;
		}
		else {
			out += `\tMemoryAddr(0x006509b0, Subtract, ${cpt0 + 1});\n`;
		}
	}
	else {
		out += `\tMemoryAddr(0x006509b0, Add, ${cpt0});\n`;
		out += `\tSet Deaths("Current Player", "Terran Marine", Set To, ${data0});\n`;
		out += `\tMemoryAddr(0x006509b0, Add, 1);\n`;
		out += `\tSet Deaths("Current Player", "Terran Marine", Set To, ${data1});\n`;

		if(diff2 != 0) {
			out += `\tMemoryAddr(0x006509b0, Add, 1);\n`;
			out += `\tSet Deaths("Current Player", "Terran Marine", Set To, ${data2});\n`;
			out += `\tMemoryAddr(0x006509b0, Subtract, ${cpt0 + 2});\n`;
		}
		else {
			out += `\tMemoryAddr(0x006509b0, Subtract, ${cpt0 + 1});\n`;
		}
	}

	return out;
}